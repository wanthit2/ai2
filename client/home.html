<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Food Finder - ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏∏‡∏ì</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Style ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
    body { font-family: 'Prompt', sans-serif; margin: 0; background-color: #f9fafb; }
    .restaurant-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
        gap: 25px; 
        padding: 20px 0;
    }
    .card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid #f1f5f9;
    }
    .card:hover { transform: translateY(-8px); box-shadow: 0 12px 25px rgba(0,0,0,0.1); }
    .card img { width: 100%; height: 200px; object-fit: cover; }
    .card-info { padding: 20px; }
    .card-info h3 { margin: 0; font-size: 1.2rem; color: #1e293b; }
    .card-info p { color: #6366f1; font-size: 0.9rem; margin: 8px 0; font-weight: 500; }
    .open-tag { color: #10b981; font-size: 0.85rem; font-weight: 600; display: flex; align-items: center; gap: 5px; }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Logout */
    .logout-btn { background: #ef4444; color: white; padding: 8px 16px; border-radius: 10px; border: none; cursor: pointer; }
  </style>
</head>
<body>

<nav class="navbar">
  <h2 class="logo" onclick="location.href='home.html'" style="cursor:pointer">üçú FoodFinder</h2>
  <ul class="menu">
    <li onclick="location.href='home.html'">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</li>
    <li onclick="goRestaurants()">‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</li>
    <li onclick="location.href='reviews.html'">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</li>
    <li onclick="location.href='profile.html'">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</li>
  </ul>
  <div id="authSection">
    <button class="login-btn" id="authBtn" onclick="location.href='login.html'">Login</button>
  </div>
</nav>

<section class="hero">
  <h1 id="welcomeText">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏∏‡∏ì</h1>
  <div class="search-box">
    <input type="text" id="homeSearch" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤...">
    <button onclick="handleSearch()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
  </div>
</section>

<section class="categories">
  <h2>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
  <div class="category-list">
    <div class="category" onclick="searchByCategory('‡πÄ‡∏™‡πâ‡∏ô')">üçú<p>‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß</p></div>
    <div class="category" onclick="searchByCategory('‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤')">üçï<p>‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤</p></div>
    <div class="category" onclick="searchByCategory('‡∏ã‡∏π‡∏ä‡∏¥')">üç£<p>‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô</p></div>
    <div class="category" onclick="searchByCategory('‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û')">ü•ó<p>‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</p></div>
    <div class="category" onclick="searchByCategory('‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà')">‚òï<p>‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà</p></div>
    <div class="category" onclick="searchByCategory('‡∏ü‡∏≤‡∏™‡∏ï‡πå‡∏ü‡∏π‡πâ‡∏î')">üçî<p>‡∏ü‡∏≤‡∏™‡∏ï‡πå‡∏ü‡∏π‡πâ‡∏î</p></div>
  </div>
</section>

<section class="restaurants" style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
  <h2>‚ú® ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</h2>
  <div class="restaurant-grid" id="featuredRestaurants">
    <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏∏‡∏ì...</p>
  </div>
</section>

<script>
// ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô API_URL ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Railway ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
const API_URL = "https://ai2-production-18cb.up.railway.app";

window.onload = function() {
    loadFeaturedShops();
    checkAuthStatus(); // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏≤‡∏£ Login ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
};

// 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
async function loadFeaturedShops() {
    try {
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Route /get-shops ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô server.js
        const response = await fetch(`${API_URL}/get-shops`);
        if (!response.ok) throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ");
        
        const shops = await response.json();
        const display = document.getElementById("featuredRestaurants");
        display.innerHTML = "";

        if (shops.length === 0) {
            display.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>";
            return;
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏à‡∏≥‡∏Å‡∏±‡∏î 6 ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏£‡∏Å)
        shops.slice(0, 6).forEach(shop => {
            // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ shop.image_url ‡∏ï‡∏£‡∏á‡πÜ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏ß‡∏Å /uploads/ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô URL ‡∏à‡∏≤‡∏Å Supabase
            const imgPath = shop.image_url 
                ? shop.image_url 
                : 'https://via.placeholder.com/400x300?text=No+Image';

            display.innerHTML += `
                <div class="card" onclick="location.href='restaurant.html?id=${shop.id}'">
                    <img src="${imgPath}" onerror="this.src='https://via.placeholder.com/400x300?text=Image+Not+Found'">
                    <div class="card-info">
                        <h3>${shop.name}</h3>
                        <p>${shop.hashtags || '#‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏á'}</p>
                        <div class="open-tag"><span>‚óè</span> ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</div>
                    </div>
                </div>
            `;
        });
    } catch (error) {
        console.error("Error:", error);
        document.getElementById("featuredRestaurants").innerHTML = "<p>‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>";
    }
}

// 2. ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Login ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö auth.js)
function checkAuthStatus() {
    const user = localStorage.getItem("user");
    const authBtn = document.getElementById("authBtn");
    const welcomeText = document.getElementById("welcomeText");

    if (user) {
        welcomeText.innerText = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${user} üëã ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏Å‡∏±‡∏ô!`;
        authBtn.innerText = "Logout";
        authBtn.className = "logout-btn";
        authBtn.onclick = logout; // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô logout ‡∏à‡∏≤‡∏Å auth.js
    }
}

// 3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
function handleSearch() {
    const keyword = document.getElementById("homeSearch").value;
    if(keyword) {
        window.location.href = `restaurants.html?search=${encodeURIComponent(keyword)}`;
    } else {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏£‡∏∑‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤");
    }
}

function searchByCategory(cat) {
    window.location.href = `restaurants.html?search=${encodeURIComponent(cat)}`;
}

function goRestaurants() {
  window.location.href = "restaurants.html";
}
</script>

<script src="auth.js"></script>
</body>
</html>
