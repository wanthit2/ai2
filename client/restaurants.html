<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FoodFinder - ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢ AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4f46e5;
      --primary-soft: #eef2ff;
      --accent: #10b981;
      --accent-soft: #ecfdf5;
      --text-main: #1e293b;
      --text-sub: #64748b;
      --bg: #f8fafc;
      --white: #ffffff;
      --ai-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
    }

    body { font-family: 'Prompt', sans-serif; background-color: var(--bg); margin: 0; color: var(--text-main); }

    /* NAVBAR */
    .navbar { display: flex; justify-content: space-between; align-items: center; padding: 1rem 5%; background: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
    .logo { font-size: 1.5rem; font-weight: 700; color: var(--primary); cursor: pointer; text-decoration: none; }

    /* HEADER & SEARCH */
    .header { text-align: center; padding: 50px 5%; background: linear-gradient(to bottom, #ffffff, #f1f5f9); }
    .search-container { max-width: 650px; margin: 0 auto 30px; }
    #searchInput { width: 100%; padding: 18px 30px; border: 2px solid #e2e8f0; border-radius: 50px; font-size: 1.1rem; outline: none; transition: 0.3s; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
    #searchInput:focus { border-color: var(--primary); }

    /* AI ASSISTANT BOX */
    .ai-box { max-width: 650px; margin: 0 auto; padding: 30px; background: var(--white); border-radius: 24px; border: 2px solid transparent; background-image: linear-gradient(white, white), var(--ai-gradient); background-origin: border-box; background-clip: padding-box, border-box; box-shadow: 0 20px 25px -5px rgba(99, 102, 241, 0.15); }
    .ai-badge { display: inline-block; background: var(--ai-gradient); color: white; padding: 4px 12px; border-radius: 50px; font-size: 0.75rem; font-weight: 600; margin-bottom: 10px; }
    .ai-input-group { display: flex; gap: 12px; margin-top: 15px; }
    .ai-input-group input { flex: 1; padding: 14px 22px; border-radius: 14px; border: 1px solid #e2e8f0; outline: none; }
    .ai-btn { background: var(--ai-gradient); color: white; border: none; padding: 0 25px; border-radius: 14px; font-weight: 600; cursor: pointer; transition: 0.2s; }
    #aiResponse { margin-top: 20px; font-weight: 600; min-height: 24px; }

    /* FOOD GRID */
    .food-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; padding: 40px 5%; max-width: 1300px; margin: 0 auto; }
    .food-card { background: var(--white); border-radius: 24px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.03); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; border: 1px solid #f1f5f9; }
    .food-card:hover { transform: translateY(-10px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    .food-card img { width: 100%; height: 220px; object-fit: cover; }
    .food-info { padding: 25px; }
    .food-tag { font-size: 0.75rem; background: var(--primary-soft); color: var(--primary); padding: 4px 10px; border-radius: 8px; font-weight: 600; }
    .price-tag { font-size: 1.3rem; font-weight: 700; color: var(--accent); }
    .no-data { grid-column: 1/-1; text-align: center; padding: 60px; color: var(--text-sub); font-size: 1.2rem; }
  </style>
</head>
<body>

<nav class="navbar">
  <a href="home.html" class="logo">üçú FoodFinder</a>
  <div style="font-size: 0.9rem; color: var(--text-sub);">AI ‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
</nav>

<div class="header">
  <h1 style="font-size: 2.2rem; margin-bottom: 10px;">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏¥‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡∏µ?</h1>
  <p style="color: var(--text-sub); margin-bottom: 35px;">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡πÇ‡∏õ‡∏£‡∏î‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>

  <div class="search-container">
    <input type="text" id="searchInput" placeholder="üîç ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤..." onkeyup="handleFilter()">
  </div>

  <div class="ai-box">
    <div class="ai-badge">AI ASSISTANT</div>
    <h3 style="margin:0; font-size: 1.2rem;">‚ú® ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÅ‡∏•‡∏∞‡∏á‡∏ö</h3>
    <p style="font-size: 0.85rem; color: var(--text-sub); margin: 5px 0;">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô 60 ‡∏≠‡∏¢‡∏≤‡∏Å‡∏Å‡∏¥‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏™‡πâ‡∏ô" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤ 50"</p>
    
    <div class="ai-input-group">
      <input type="text" id="aiPrompt" placeholder="‡∏ö‡∏≠‡∏Å‡∏á‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≤‡∏ô..." onkeypress="if(event.key==='Enter') askAI()">
      <button class="ai-btn" onclick="askAI()">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
    </div>
    <div id="aiResponse"></div>
  </div>
</div>

<div class="food-grid" id="foodDisplay">
  <div class='no-data'>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì...</div>
</div>

<script>
const API_URL = "https://ai2-production-18cb.up.railway.app";
let allFoods = []; 

window.onload = async function() {
    await loadAllFoods();
};

async function loadAllFoods() {
    try {
        const response = await fetch(`${API_URL}/get-all-foods`);
        allFoods = await response.json();
        renderFoods(allFoods);
    } catch (error) {
        document.getElementById("foodDisplay").innerHTML = "<div class='no-data'>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</div>";
    }
}

function renderFoods(foods) {
    const display = document.getElementById("foodDisplay");
    
    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° HTML ‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£ += ‡∏•‡∏á‡πÉ‡∏ô display.innerHTML ‡∏ï‡∏£‡∏á‡πÜ ‡∏ó‡∏∏‡∏Å‡∏£‡∏≠‡∏ö)
    let htmlContent = foods.length ? "" : "<div class='no-data'>üîç ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</div>";

    foods.forEach(food => {
        // ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô placehold.co ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Error ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô
        const imgPath = food.image_url ? `${API_URL}/uploads/${food.image_url}` : 'https://placehold.co/400x300?text=No+Image';
        
        htmlContent += `
            <div class="food-card" onclick="window.location.href='restaurant.html?id=${food.shop_id}'">
                <img src="${imgPath}" onerror="this.src='https://placehold.co/400x300?text=No+Image'">
                <div class="food-info">
                    <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:10px;">
                        <small style="color:var(--text-sub)">üìç ${food.shop_name}</small>
                        <span class="food-tag">${food.category || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}</span>
                    </div>
                    <h3 style="margin:0 0 15px 0; font-size: 1.25rem;">${food.name}</h3>
                    <div style="display:flex; justify-content:space-between; align-items:center; border-top:1px solid #f1f5f9; padding-top:15px;">
                        <span style="color:var(--text-sub); font-size:0.9rem;">‡∏£‡∏≤‡∏Ñ‡∏≤</span>
                        <span class="price-tag">‡∏ø${food.price}</span>
                    </div>
                </div>
            </div>
        `;
    });
    
    // ‡∏ô‡∏≥ HTML ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    display.innerHTML = htmlContent;
}

function handleFilter() {
    const keyword = document.getElementById("searchInput").value.toLowerCase();
    const filtered = allFoods.filter(f => 
        f.name.toLowerCase().includes(keyword) || 
        f.shop_name.toLowerCase().includes(keyword) ||
        (f.category && f.category.toLowerCase().includes(keyword))
    );
    renderFoods(filtered);
}

function askAI() {
    const prompt = document.getElementById("aiPrompt").value.trim().toLowerCase();
    const responseDiv = document.getElementById("aiResponse");
    
    if (!prompt) return;
    responseDiv.innerHTML = "ü§ñ AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...";
    responseDiv.style.color = "var(--primary)";

    setTimeout(() => {
        // 1. ‡∏î‡∏∂‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
        const budgetMatch = prompt.match(/\d+/);
        const budget = budgetMatch ? parseInt(budgetMatch[0]) : null;

        // 2. Mapping ‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏≤ "‡πÄ‡∏™‡πâ‡∏ô" ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏à‡∏≠ "‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏™‡πâ‡∏ô" ‡πÉ‡∏ô DB)
        const catMap = {
            "‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏™‡πâ‡∏ô": ["‡πÄ‡∏™‡πâ‡∏ô", "‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß", "‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà", "‡∏£‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤", "‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢", "‡∏´‡∏°‡∏µ‡πà"],
            "‡πÄ‡∏°‡∏ô‡∏π‡∏Ç‡πâ‡∏≤‡∏ß": ["‡∏Ç‡πâ‡∏≤‡∏ß", "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤", "‡∏à‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß", "‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î"]
        };

        let targetCategory = "";
        for (let key in catMap) {
            if (catMap[key].some(word => prompt.includes(word))) {
                targetCategory = key;
                break;
            }
        }

        // 3. ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const filtered = allFoods.filter(food => {
            const price = Number(food.price);
            const foodName = food.name.toLowerCase();
            const foodCat = (food.category || "").toLowerCase();

            // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏á‡∏ö
            const budgetOk = budget ? price <= budget : true;
            
            // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏Ñ‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π ‡∏´‡∏£‡∏∑‡∏≠ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏î‡πâ)
            const textSearch = prompt.replace(/[0-9]/g, '').replace('‡∏ö‡∏≤‡∏ó', '').replace('‡∏á‡∏ö', '').trim();
            const textMatch = textSearch.length > 0 ? foodName.includes(textSearch) : true;
            const categoryMatch = targetCategory ? foodCat === targetCategory.toLowerCase() : true;

            // ‡∏ñ‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏Ñ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            if (prompt === budget?.toString()) return budgetOk;

            return budgetOk && (textMatch || categoryMatch);
        });

        // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        if (filtered.length > 0) {
            filtered.sort((a, b) => b.price - a.price);
            responseDiv.innerHTML = `ü§ñ AI ‡∏û‡∏ö ${filtered.length} ‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì!`;
            renderFoods(filtered);
        } else {
            responseDiv.innerHTML = "ü§ñ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡πÉ‡∏à‡πÄ‡∏•‡∏¢ ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏ö‡∏î‡∏π‡∏ô‡∏∞";
            responseDiv.style.color = "#ef4444";
            renderFoods([]);
        }
    }, 600);
}
</script>
</body>
</html>
